"use strict";angular.module("boozeApp",["ngAnimate","ngRoute","ngTouch"]).run(function($rootScope,$timeout,$window){$rootScope.$on("$routeChangeSuccess",function(){$timeout(function(){$window.scrollTo(0,0)},500)})}).config(function($routeProvider){var booze=function(resolveFactory){return resolveFactory.boozeResolve()};$routeProvider.when("/",{templateUrl:"views/beer.html",controller:"BeerCtrl",resolve:{boozejson:booze}}).when("/whiskey",{templateUrl:"views/whiskey.html",controller:"WhiskeyCtrl",resolve:{boozejson:booze}}).when("/input",{templateUrl:"views/input.html",controller:"InputCtrl"}).when("/beer/:id",{templateUrl:"views/details.html",controller:"DetailCtrl",resolve:{boozejson:booze}}).when("/whiskey/:id",{templateUrl:"views/details.html",controller:"DetailCtrl",resolve:{boozejson:booze}}).otherwise({redirectTo:"/"})}).config(function($httpProvider){$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";var param=function(obj){var name,value,fullSubName,subName,subValue,innerObj,i,query="";for(name in obj)if(value=obj[name],value instanceof Array)for(i=0;i<value.length;++i)subValue=value[i],fullSubName=name+"["+i+"]",innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+"&";else if(value instanceof Object)for(subName in value)subValue=value[subName],fullSubName=name+"["+subName+"]",innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+"&";else void 0!==value&&null!==value&&(query+=encodeURIComponent(name)+"="+encodeURIComponent(value)+"&");return query.length?query.substr(0,query.length-1):query};$httpProvider.defaults.transformRequest=[function(data){return angular.isObject(data)&&"[object File]"!==String(data)?param(data):data}]}),angular.module("boozeApp").factory("resolveFactory",function($window,storageFactory,getBoozeFactory){return{boozeResolve:function(){if(null===storageFactory.getBoozeData("booze-data-cache")){var elseReturn=getBoozeFactory.getBoozeData().then(function(data){storageFactory.storeGetBoozeData("booze-data-cache",data)},function(){$window.alert("They Peed on Your Fucking Rug Dude")});return elseReturn}}}}),angular.module("boozeApp").constant("beerkey","beer"),angular.module("boozeApp").constant("whiskeykey","whiskey"),angular.module("boozeApp").factory("getBoozeFactory",function($http){return{getBoozeData:function(){return $http.get("data/booze.json",{cache:!1}).then(function(result){return result.data})}}}),angular.module("boozeApp").factory("storageFactory",function($http){return{getBoozeData:function(key){return angular.fromJson(sessionStorage.getItem(key))},storeGetBoozeData:function(key,retrievedData){sessionStorage.setItem(key,angular.toJson(retrievedData))},storeBoozeLocal:function(key,oldData,newData){sessionStorage.setItem(key,angular.toJson(oldData.concat(newData)))},storeBoozeRemote:function(key){$http.post("jsonsave.php",sessionStorage.getItem(key)).success(function(data,status){console.log(status,data)}).error(function(data,status){console.log(status,data)})},updateBoozeLocal:function(key,originalCloset,newObject){for(var i=0;i<originalCloset.length;i++)newObject.id===originalCloset[i].id&&(originalCloset[i]=newObject,sessionStorage.setItem(key,angular.toJson(originalCloset)))}}}),angular.module("boozeApp").factory("randomnumber",function(){return{randomid:function(){var min=1e5,max=2e5,stringMe=Math.floor(Math.random()*(max-min+1))+min;return stringMe.toString()}}}),angular.module("boozeApp").controller("BeerCtrl",function($scope,storageFactory,listdataFilter,beerkey,storagekey){$scope.beerList=listdataFilter.beer(storageFactory.getBoozeData(storagekey),beerkey)}),angular.module("boozeApp").controller("InputCtrl",function($scope,$location,$window,beerkey,whiskeykey,storagekey,randomnumber,storageFactory){$scope.boozeForm=[],$scope.beerVisible=!1,$scope.whiskeyVisible=!1,$scope.beerToggle=function(){$scope.beerVisible=!0,$scope.whiskeyVisible=!1,$scope.boozeForm.type=beerkey},$scope.whiskeyToggle=function(){$scope.beerVisible=!1,$scope.whiskeyVisible=!0,$scope.boozeForm.type=whiskeykey},$scope.boozeForm.saveBooze=function(){var boozeDataNew=[{id:randomnumber.randomid(),type:$scope.boozeForm.type,purchasedfrom:$scope.boozeForm.purchasedfrom,purchasedon:$scope.boozeForm.purchasedon,price:$scope.boozeForm.price,name:$scope.boozeForm.name,company:$scope.boozeForm.company,status:$scope.boozeForm.status}];storageFactory.storeBoozeLocal(storagekey,storageFactory.getBoozeData(storagekey),boozeDataNew),storageFactory.storeBoozeRemote(storagekey,storageFactory.getBoozeData(storagekey)),$window.alert("Your New Booze:  "+$scope.boozeForm.name+"\n\nFrom:  "+$scope.boozeForm.company+"\n\nHas Been Added!!\n\n Locally and to the Server");var newUrl;newUrl="beer"!==boozeDataNew.type?"/"+boozeDataNew[0].type:"/",$location.path(newUrl)}}),angular.module("boozeApp").controller("NavCtrl",function($scope,$location){$scope.isActive=function(route){return route===$location.path()}}),angular.module("boozeApp").controller("WhiskeyCtrl",function($scope,listdataFilter,storageFactory,whiskeykey,storagekey){$scope.whiskeyList=listdataFilter.beer(storageFactory.getBoozeData(storagekey),whiskeykey)}),angular.module("boozeApp").filter("listdata",function(){return{beer:function(input,arg){var outBeerList=[];return angular.forEach(input,function(boozeItem){boozeItem.type===arg&&this.push(boozeItem)},outBeerList),outBeerList},whiskey:function(input,arg){var outWhiskeyList=[];return angular.forEach(input,function(boozeItem){boozeItem.type===arg&&this.push(boozeItem)},outWhiskeyList),outWhiskeyList},singleBooze:function(input,arg){var outBoozeItem=[];return angular.forEach(input,function(boozeItem){boozeItem.id===arg&&this.push(boozeItem)},outBoozeItem),outBoozeItem.shift()}}}),angular.module("boozeApp").directive("beerInput",function(){return{templateUrl:"views/beerinputform.html",restrict:"A",replace:!0}}),angular.module("boozeApp").directive("whiskeyInput",function(){return{templateUrl:"views/whiskeyinputform.html",restrict:"A",replace:!0}}),angular.module("boozeApp").controller("DetailCtrl",function($scope,$routeParams,$location,$window,storageFactory,listdataFilter,storagekey){$scope.boozeItem=listdataFilter.singleBooze(storageFactory.getBoozeData(storagekey),$routeParams.id),$scope.boozeItem.upDate=function(){var boozeObjectNew={id:$scope.boozeItem.id,type:$scope.boozeItem.type,purchasedfrom:$scope.boozeItem.purchasedfrom,purchasedon:$scope.boozeItem.purchasedon,price:$scope.boozeItem.price,name:$scope.boozeItem.name,company:$scope.boozeItem.company,status:$scope.boozeItem.status};storageFactory.updateBoozeLocal(storagekey,storageFactory.getBoozeData(storagekey),boozeObjectNew),storageFactory.storeBoozeRemote(storagekey,storageFactory.getBoozeData(storagekey)),$window.alert("Your New Booze:  "+$scope.boozeItem.name+"\n\nFrom:  "+$scope.boozeItem.company+"\n\nHas Been Updated!!\n\n Both Locally and on the Server!");var newUrl;newUrl="beer"!==boozeObjectNew.type?"/"+boozeObjectNew.type:"/",$location.path(newUrl)}}),angular.module("boozeApp").constant("storagekey","booze-data-cache");